<script>
    // Google Sheets Collection Script
    // Instructions:
    // 1. Create a Google Sheet.
    // 2. Go to Extensions > Apps Script.
    // 3. Paste the code provided by the assistant.
    // 4. Deploy as Web App (Execute as: Me, Who can access: Anyone).
    // 5. Paste the Web App URL below between the quotes.

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx-lGkwPmy_N62aB-FPJIBOQ2ZLOQNndSvamW1BD3PpXJx1PnfAP-YtVhIZRR7WS-mJUA/exec";

    document.addEventListener('DOMContentLoaded', function () {
        const checkForm = setInterval(() => {
            const formContainer = document.querySelector('#rec1224846206');
            const form = formContainer ? formContainer.querySelector('form') : null;

            if (form) {
                clearInterval(checkForm);
                console.log("Form found, attaching listener");

                // Remove Tilda's default behavior if possible or just override
                form.onsubmit = function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    if (GOOGLE_SCRIPT_URL === "https://script.google.com/macros/s/AKfycbx-lGkwPmy_N62aB-FPJIBOQ2ZLOQNndSvamW1BD3PpXJx1PnfAP-YtVhIZRR7WS-mJUA/exec" || GOOGLE_SCRIPT_URL === "https://script.google.com/macros/s/AKfycbx-lGkwPmy_N62aB-FPJIBOQ2ZLOQNndSvamW1BD3PpXJx1PnfAP-YtVhIZRR7WS-mJUA/exec") {
                        alert("Please set the GOOGLE_SCRIPT_URL in the HTML file!");
                        return;
                    }

                    const btn = form.querySelector('.t-submit');
                    const originalText = btn.innerText;
                    btn.innerText = 'Жіберілуде...'; // Sending...
                    btn.style.opacity = "0.7";

                    const formData = new FormData(form);

                    fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        body: formData,
                        mode: 'no-cors' // Important for Google Apps Script
                    })
                        .then(() => {
                            btn.innerText = 'Рахмет! Жауап қабылданды.'; // Thank you!
                            btn.style.backgroundColor = "#2e7d32"; // Green success
                            form.reset();
                            setTimeout(() => {
                                btn.innerText = originalText;
                                btn.style.backgroundColor = "";
                                btn.style.opacity = "1";
                            }, 5000);
                        })
                        .catch(error => {
                            console.error('Error!', error.message);
                            btn.innerText = 'Қате кетті (Error)';
                            setTimeout(() => {
                                btn.innerText = originalText;
                            }, 3000);
                        });
                };
            }
        }, 1000);
    });
</script>